import{aK as S,v as E,r as d,c as L,o as M,y as g,z as P,A as s,B as o,j as a,S as v,L as A,H as c,aR as I,J as h,C as r,K as O,D as b,bB as Y,F as $,a$ as F,b0 as R,O as U,I as _,b5 as G}from"./index.866f479f.js";import{Q as k}from"./QTooltip.c447365b.js";import{Q as J,a as m}from"./QTable.5b602739.js";import{Q as K}from"./QTr.666adf8d.js";import{Q as Z}from"./QPage.ae304a4d.js";import{h as w}from"./locale.d09498a2.js";import{f as H,a as j,_ as W}from"./useLogs.d62d92d8.js";import"./ClosePopup.e4ce3c17.js";const X={class:"borderd"},ee={class:"q-px-lg q-py-sm row no-wrap justify-between items-center bg-grey-3"},ae={class:"row no-wrap items-center q-gutter-x-sm q-py-xs"},se=o("div",{class:"font-main"},"\uC774\uBCA4\uD2B8 \uB85C\uADF8",-1),te={class:"row no-wrap items-center q-gutter-x-sm"},oe={key:0,class:"q-pa-sm bg-blue-grey-1 row justify-center items-center"},ne={class:"q-gutter-x-sm row no-wrap items-center"},re=o("span",{class:"text-bold"},"\uB0A0\uC9DC",-1),le=o("span",null,"~",-1),ie={style:{"font-size":"0.8rem"}},we={__name:"EventlogPage",setup(ce){const{fnNotiError:z}=S(),D=[{name:"createdAt",label:"Time",align:"center",field:"createdAt",sortable:!0},{name:"level",label:"Level",align:"center",field:"level",sortable:!0},{name:"source",label:"Source",align:"center",field:"source",sortable:!0},{name:"zones",label:"Zones",align:"center",field:"zones",sortable:!0},{name:"message",label:"Message",align:"left",field:"message",sortable:!0}],y=E(),f=d(""),l=d(""),i=d(""),Q=d([]),u=d({sortBy:"createdAt",descending:!0,page:1,rowsPerPage:10,rowsNumber:0}),N=L(()=>l.value||i.value),B=()=>{let t=[];return _.value.isAdmin?null:(_.value.zones&&_.value.zones.length&&_.value.zones.forEach(n=>{G.value.forEach(e=>{n===e.deviceId&&t.push(e.name)})}),t)},x=async t=>{try{y.loading.show();const n={...t,level:4,start:l.value,end:i.value,devices:B()},{data:e}=await U.get(`/logs?options=${JSON.stringify(n)}`);Q.value=e.current,u.value=e.pagination}catch(n){console.error(n)}finally{y.loading.hide()}},p=async()=>{await x({pagination:u.value,filter:f.value})},T=async()=>{l.value="",i.value="",await p()},V=()=>{y.dialog({component:W,componentProps:{start:l.value,end:i.value}}).onOk(async t=>{if(w(new Date(t.start)).isAfter(w())){z("\uC2DC\uC791 \uC2DC\uAC04\uC774 \uC624\uB298\uBCF4\uB2E4 \uB2A6\uC2B5\uB2C8\uB2E4.");return}if(w(new Date(t.start)).isAfter(w(new Date(t.end)))){z("\uC2DC\uC791 \uC2DC\uAC04\uC774 \uC885\uB8CC \uC2DC\uAC04\uBCF4\uB2E4 \uB2A6\uC2B5\uB2C8\uB2E4.");return}l.value=t.start,i.value=t.end,u.value.page=1,await p()})};return M(async()=>{await p()}),(t,n)=>(g(),P(Z,{class:"page"},{default:s(()=>[o("div",X,[o("div",ee,[o("div",ae,[a(v,{name:"list_alt",color:"primary",size:"md"}),se,a(A,{flat:"",dense:"",round:"",icon:"refresh",color:"primary",onClick:p},{default:s(()=>[a(k,null,{default:s(()=>[c("\uC0C8\uB85C\uACE0\uCE68")]),_:1})]),_:1})]),o("div",te,[a(I,{modelValue:f.value,"onUpdate:modelValue":n[0]||(n[0]=e=>f.value=e),borderless:"",dense:"",debounce:"300",placeholder:"Search",clearable:""},{append:s(()=>[a(v,{class:"cursor-pointer",name:"search"})]),_:1},8,["modelValue"]),a(A,{flat:"",round:"",icon:"settings",size:"sm",color:"primary",onClick:V},{default:s(()=>[a(k,null,{default:s(()=>[c("\uAC80\uC0C9\uC635\uC158")]),_:1})]),_:1})])]),N.value?(g(),h("div",oe,[o("div",ne,[a(v,{name:"calendar_month",color:"primary",size:"sm"}),re,o("span",null,r(l.value),1),le,o("span",null,r(i.value),1),a(v,{class:"cursor-pointer",name:"cancel",color:"red-10",size:"xs",onClick:T},{default:s(()=>[a(k,null,{default:s(()=>[c("\uD574\uC81C")]),_:1})]),_:1})])])):O("",!0),a(J,{flat:"",columns:D,rows:Q.value,filter:f.value,"row-key":"_id","wrap-cells":"",pagination:u.value,"onUpdate:pagination":n[1]||(n[1]=e=>u.value=e),onRequest:x},{body:s(e=>[a(K,{props:e},{default:s(()=>[a(m,{key:"createdAt",props:e},{default:s(()=>[o("div",ie,r(b(Y).formatDate(e.row.createdAt,"YYYY-MM-DD hh:mm:ss a")),1)]),_:2},1032,["props"]),a(m,{key:"level",props:e},{default:s(()=>[c(r(e.row.level.toUpperCase()),1)]),_:2},1032,["props"]),a(m,{key:"source",props:e},{default:s(()=>[c(r(e.row.source),1)]),_:2},1032,["props"]),a(m,{key:"zones",props:e},{default:s(()=>[c(r(e.row.zones&&e.row.zones.length?e.row.zones.join(","):""),1)]),_:2},1032,["props"]),a(m,{class:"message",key:"message",props:e},{default:s(()=>[(g(!0),h($,null,F(b(H)(e.row.message),(q,C)=>(g(),h("span",{key:C,class:R(["q-ml-xs",b(j)(q,C)])},r(q),3))),128))]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","filter","pagination"])])]),_:1}))}};export{we as default};
