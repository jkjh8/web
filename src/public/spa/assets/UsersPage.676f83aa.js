import{c as Y,aO as x,t as w,B as C,F as U,aM as B,j as a,x as o,J as h,G as d,r as Q,o as I,v as M,L as F,N as D,y as l,bi as N,Q as _,bj as O,aF as S,aG as G,aD as L,E as A,z as g,M as T,aJ as Z,P as k,aH as j}from"./index.854d2d6b.js";import{Q as u,a as E}from"./QTable.7ea2ade9.js";import{Q as R}from"./QTr.6b406152.js";import{Q as J}from"./QPage.013074bc.js";import{u as H}from"./use-quasar.fba98d94.js";import{d as z}from"./date.2b3522d4.js";import{d as K,Q as W,a as X,b as $,c as q}from"./QSelect.bb125c9c.js";import{u as P}from"./use-dialog-plugin-component.b10ae4ca.js";import{_ as V}from"./dialogConfirm.77211406.js";import"./QLinearProgress.fd23f41f.js";import"./format.cbf00d5d.js";import"./QMenu.de6036a3.js";const ee={__name:"userZone",props:["zones"],setup(y){const p=y,m=Y(()=>{if(p.zones&&p.zones.length){const c=[];for(let n of p.zones){const r=x.value.findIndex(i=>i.deviceId===n);r!==-1&&c.push(x.value[r])}return c}else return[]});return(c,n)=>(w(),C("div",null,[(w(!0),C(U,null,B(m.value,(r,i)=>(w(),C("span",{key:i},[a(K,{class:"font-main text-bold",icon:"location_on",size:"sm",color:"primary","text-color":"white"},{default:o(()=>[h(d(r.name),1)]),_:2},1024)]))),128))]))}},ae=l("div",{class:"q-px-sm dialog-name"},"\uBC29\uC1A1\uAD6C\uAC04\uC120\uD0DD",-1),oe={class:"q-px-md"},ne={class:"q-px-sm"},te={__name:"selectZones",props:["zones"],emits:[...P.emits],setup(y,{emit:p}){const{dialogRef:m,onDialogOK:c,onDialogCancel:n}=P(),r=y,i=Q(null),v=Q([]),f=(s,t,e)=>{t(()=>{v.value=x.value.filter(b=>b.name.indexOf(s)>-1)})};return I(()=>{v.value=x.value,r.zones&&r.zones.length>0&&(i.value=r.zones)}),(s,t)=>(w(),M(F,{ref_key:"dialogRef",ref:m,persistent:""},{default:o(()=>[a(T,{class:"q-dialog-plugin",style:{"border-radius":"0.6rem"}},{default:o(()=>[a(D,null,{default:o(()=>[ae]),_:1}),a(D,null,{default:o(()=>[l("div",oe,[a(W,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),options:v.value,filled:"",dense:"",multiple:"",label:"\uBC29\uC1A1\uC9C0\uC5ED\uC120\uD0DD","option-value":"deviceId","option-label":"name","use-chips":"","stack-label":"","use-input":"","input-debounce":"0","emit-value":"","map-options":"",onFilter:f},N({option:o(e=>[a(X,S(G(e.itemProps)),{default:o(()=>[a($,{avatar:""},{default:o(()=>[a(_,{name:"storage"})]),_:1}),a($,null,{default:o(()=>[a(q,null,{default:o(()=>[h(d(e.opt.name),1)]),_:2},1024),a(q,{caption:""},{default:o(()=>[h(d(e.opt.ipaddress),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:2},[i.value?{name:"append",fn:o(()=>[a(_,{name:"cancel",size:"18px",onClick:t[0]||(t[0]=O(e=>i.value=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"])])]),_:1}),a(L,{align:"right"},{default:o(()=>[l("div",ne,[a(A,{round:"",flat:"",color:"red-10",icon:"cancel",onClick:g(n)},null,8,["onClick"]),a(A,{round:"",flat:"","no-caps":"",color:"primary",icon:"check_circle",onClick:t[2]||(t[2]=e=>g(c)(i.value))})])]),_:1})]),_:1})]),_:1},512))}},se={class:"borderd"},le={class:"q-px-lg row no-wrap justify-between items-center bg-grey-2"},ie={class:"row no-wrap items-center q-gutter-x-sm"},re=l("div",{class:"font-main",style:{"font-size":"16px","font-weight":"bold"}},"\uC0AC\uC6A9\uC790 \uAD00\uB9AC",-1),de={class:"row items-center q-gutter-x-xs"},ce={style:{"font-size":"10px"}},me={style:{"font-size":"10px"}},xe={__name:"UsersPage",setup(y){const p=[{name:"email",label:"E-mail",align:"center",field:"email",sortable:!0},{name:"name",label:"Name",align:"center",field:"name",sortable:!0},{name:"isAdmin",label:"isAdmin",align:"center",field:"isAdmin",sortable:!0},{name:"zones",label:"Zones",align:"center",field:"zones",sortable:!0},{name:"loginAt",label:"Last login",align:"center",field:"loginAt",sortable:!0},{name:"createdAt",label:"Created at",align:"center",field:"createdAt",sortable:!0},{name:"actions",label:"FN",align:"center"}],m=Q(""),c=Q([]),n=H(),r=s=>{n.dialog({component:V,componentProps:{title:"\uAD00\uB9AC\uC790 \uAD8C\uD55C \uBCC0\uACBD",icon:"warning",iconColor:"yellow",message:`${s.email} \uAD00\uB9AC\uC790 \uAD8C\uD55C ${s.isAdmin?"\uD68C\uC218":"\uBD80\uC5EC"} \uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?`}}).onOk(async()=>{try{n.loading.show(),await k.put("/users/admin",{...s}),await f(),n.loading.hide()}catch(t){n.loading.hide(),console.error(t)}})},i=async s=>{n.dialog({component:V,componentProps:{title:"\uC0AC\uC6A9\uC790 \uC0AD\uC81C",icon:"error",iconColor:"red-10",message:`${s.email} \uC0AC\uC6A9\uC790\uB97C \uC0AD\uC81C \uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?`}}).onOk(async()=>{try{n.loading.show(),await k.delete("/users",{data:{...s}}),await f(),n.loading.hide()}catch(t){n.loading.hide(),console.error(t)}})},v=s=>{n.dialog({component:te,componentProps:{zones:s.zones}}).onOk(async t=>{try{n.loading.show(),await k.put("/users",{user:s,update:{zones:t}}),await f(),n.loading.hide()}catch(e){n.loading.hide(),console.error(e)}console.log(t)})},f=async()=>{const s=await k.get("/users");c.value=s.data.users};return I(async()=>{n.loading.show(),await Z(),await f(),n.loading.hide()}),(s,t)=>(w(),M(J,{class:"q-pa-md"},{default:o(()=>[l("div",se,[l("div",le,[l("div",ie,[a(_,{name:"group",color:"primary",size:"24px"}),re]),a(j,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=e=>m.value=e),borderless:"",dense:"",debounce:"300",placeholder:"Search",clearable:""},{append:o(()=>[a(_,{class:"cursor-pointer",name:"search"})]),_:1},8,["modelValue"])]),a(E,{columns:p,rows:c.value,filter:m.value},{body:o(e=>[a(R,{props:e},{default:o(()=>[a(u,{key:"email",props:e},{default:o(()=>[h(d(e.row.email),1)]),_:2},1032,["props"]),a(u,{key:"name",props:e},{default:o(()=>[h(d(e.row.name),1)]),_:2},1032,["props"]),a(u,{key:"isAdmin",props:e},{default:o(()=>[a(_,{class:"cursor-pointer",size:"xs",name:e.row.isAdmin?"check_circle":"block",color:e.row.isAdmin?"primary":"red-10",onClick:b=>r(e.row)},null,8,["name","color","onClick"])]),_:2},1032,["props"]),a(u,{key:"zones",props:e},{default:o(()=>[l("div",de,[a(ee,{zones:e.row.zones},null,8,["zones"]),a(_,{class:"cursor-pointer",size:"14px",name:"edit",color:"primary",onClick:b=>v(e.row)},null,8,["onClick"])])]),_:2},1032,["props"]),a(u,{key:"loginAt",props:e},{default:o(()=>[l("div",ce,[l("div",null,d(g(z).formatDate(e.row.loginAt,"YYYY-MM-DD")),1),l("div",null,d(g(z).formatDate(e.row.loginAt,"hh:mm:ss a")),1)])]),_:2},1032,["props"]),a(u,{key:"createdAt",props:e},{default:o(()=>[l("div",me,[l("div",null,d(g(z).formatDate(e.row.createdAt,"YYYY-MM-DD")),1),l("div",null,d(g(z).formatDate(e.row.createdAt,"hh:mm:ss a")),1)])]),_:2},1032,["props"]),a(u,{key:"actions",props:e},{default:o(()=>[l("div",null,[a(A,{round:"",flat:"",icon:"delete",color:"red-10",size:"sm",onClick:b=>i(e.row)},null,8,["onClick"])])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","filter"])])]),_:1}))}};export{xe as default};
