import{y as v,I as z,j as t,A as a,G as m,P as S,L as X,B as r,C as w,J as H,F as re,b3 as De,z as Q,D as y,br as je,v as qe,o as Ee,b0 as ge,K as O,r as N,bE as Ge,N as Xe,O as R,S as Dt,U as E,V as G,W as A,az as Je,p as be,w as Oe,_ as qt,c7 as Ct,f as St,a1 as Mt,af as Vt,bi as $t,ag as zt,bO as Qt,c as V,bT as ke,bM as ae,n as Pt,as as Ot,bQ as Tt,a8 as It,h as q,g as At,bU as jt,bu as Yt,q as Ft,aP as et,aX as Ht,ay as Ut,k as Bt,aU as we,aT as Kt,R as Nt,$ as Wt,b1 as Lt,b2 as Rt}from"./index.9135e184.js";import{Q as P}from"./QTooltip.3fe8f753.js";import{Q as Zt}from"./QPage.6a46673d.js";import{s as xe,u as Ye,f as Fe,a as Et,b as He,c as Gt,d as Xt,e as Jt}from"./useScheduleFunc.df03aaa9.js";import{a as L,Q as el}from"./QTable.9d326ce5.js";import{Q as tl}from"./QTr.f7e75577.js";import{l as tt,h as J,m as ll,w as al}from"./locale.0682628a.js";import{u as lt}from"./usePlayer.21586179.js";import{Q as Te,u as nl,b as ol,c as sl,g as ul,a as il}from"./QPopupProxy.a97a0e6c.js";import{C as Ie}from"./ClosePopup.0cbff98d.js";import{_ as Ue}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as Ze}from"./QSelect.040b8d3a.js";import{T as rl}from"./useFiles.05a89255.js";import{Q as cl}from"./QBadge.e2f58d37.js";import{Q as dl}from"./QForm.2de6dd44.js";import{_ as ml,f as fl,a as vl,D as _l,b as yl}from"./useZones.17bb536f.js";import{r as Pe,d as hl}from"./useRules.38532059.js";import{u as pl}from"./useTts.0c0829c8.js";import"./position-engine.20896df7.js";import"./DialogConfirm.cfff0bd3.js";import"./QMenu.e9960093.js";import"./QSlideTransition.1d1bdbdc.js";import"./DialogInput.e17e4574.js";import"./QExpansionItem.df48638d.js";import"./QBanner.c42dd8d7.js";const kl={class:"row no-wrap q-gutter-x-sm"},wl={__name:"modeSelector",setup(e){return(d,x)=>(v(),z("div",kl,[t(S,{class:"cursor-pointer",name:"list_alt",size:"sm",color:"primary",onClick:x[0]||(x[0]=()=>xe.value="list")},{default:a(()=>[t(P,null,{default:a(()=>[m("\uB9AC\uC2A4\uD2B8")]),_:1})]),_:1}),t(X,{vertical:"",color:"grey-4"}),t(S,{class:"cursor-pointer",name:"calendar_month",size:"sm",color:"primary",onClick:x[1]||(x[1]=()=>xe.value="month")},{default:a(()=>[t(P,null,{default:a(()=>[m("\uC6D4\uAC04")]),_:1})]),_:1})]))}},gl={key:0},bl={key:1},xl={key:2},Dl={__name:"timeView",props:["repeat","weekDays","date","time"],setup(e){return(d,x)=>(v(),z("div",null,[e.repeat==="once"?(v(),z("div",gl,[r("div",null,w(e.date),1),r("div",null,w(e.time),1)])):H("",!0),e.repeat==="everyDay"?(v(),z("div",bl,w(e.time),1)):H("",!0),e.repeat==="everyWeek"||e.repeat==="workDays"?(v(),z("div",xl,[r("div",null,[(v(!0),z(re,null,De(e.weekDays,k=>(v(),Q(je,{key:k,color:"primary","text-color":"white",size:"sm"},{default:a(()=>[m(w(y(tt).days[k]),1)]),_:2},1024))),128))]),r("div",null,w(e.time),1)])):H("",!0)]))}},ql=[{name:"name",label:"\uC774\uB984",align:"center",field:"name",sortable:!0},{name:"user",label:"\uC0AC\uC6A9\uC790",align:"center",field:"user",sortable:!0},{name:"active",label:"\uD65C\uC131\uD654",align:"center",field:"active",sortable:!0},{name:"repeat",label:"\uBC18\uBCF5",align:"center",field:"repeat",sortable:!0},{name:"time",label:"\uC2DC\uAC04",align:"center",sortable:!0},{name:"zones",label:"\uBC29\uC1A1\uAD6C\uAC04",align:"center",field:"zones",sortable:!0},{name:"file",label:"\uD30C\uC77C",align:"center",field:"file",sortable:!0},{name:"actions",label:"\uAE30\uB2A5",align:"center"}],Cl={key:0},Sl={__name:"listView",setup(e){const d=qe(),{fnPlayStart:x}=lt(),{fnDeleteSchedule:k,fnActiveSchedule:h,fnSyncFileSchedule:g}=Ye();return Ee(async()=>{d.loading.show();try{await Fe()}catch(p){console.error(p)}finally{d.loading.hide()}}),(p,j)=>(v(),Q(el,{columns:y(ql),rows:y(He),pagination:{rowsPerPage:10}},{body:a(c=>[t(tl,{props:c,class:ge(c.row.active?"":"text-grey-5")},{default:a(()=>[t(L,{key:"name",props:c},{default:a(()=>[m(w(c.row.name)+" ",1),t(P,{delay:2e3},{default:a(()=>[m(w(c.row.idx),1)]),_:2},1024)]),_:2},1032,["props"]),t(L,{key:"user",props:c},{default:a(()=>[m(w(c.row.user),1)]),_:2},1032,["props"]),t(L,{key:"active",props:c},{default:a(()=>[t(O,{flat:"",round:"",icon:c.row.active?"check_circle":"block",color:c.row.active?"positive":"negative",size:"sm",onClick:D=>y(h)(c.row)},{default:a(()=>[t(P,null,{default:a(()=>[m(w(c.row.active?"\uD65C\uC131\uD654":"\uBE44\uD65C\uC131\uD654"),1)]),_:2},1024)]),_:2},1032,["icon","color","onClick"])]),_:2},1032,["props"]),t(L,{key:"repeat",props:c},{default:a(()=>[m(w(y(Et)(c.row.repeat)),1)]),_:2},1032,["props"]),t(L,{key:"time",props:c},{default:a(()=>[t(Dl,{repeat:c.row.repeat,weekDays:c.row.weekDays,date:c.row.date,time:c.row.time},null,8,["repeat","weekDays","date","time"])]),_:2},1032,["props"]),t(L,{key:"zones",props:c},{default:a(()=>[(v(!0),z(re,null,De(c.row.zones,D=>(v(),z("span",{key:D},[t(je,{size:"sm",color:c.row.active?"primary":"grey-5","text-color":"white"},{default:a(()=>[m(w(D),1)]),_:2},1032,["color"])]))),128))]),_:2},1032,["props"]),t(L,{key:"file",props:c},{default:a(()=>[c.row.file?(v(),z("div",Cl,[t(O,{flat:"",round:"",disable:!c.row.active,icon:"play_arrow",size:"sm",color:c.row.active?"primary":"grey-5",onClick:D=>y(x)(c.row.file)},null,8,["disable","color","onClick"]),r("span",null,w(c.row.file.base),1)])):H("",!0)]),_:2},1032,["props"]),t(L,{key:"actions",props:c},{default:a(()=>[r("div",null,[t(O,{round:"",flat:"",icon:"backup",color:"primary",size:"sm",onClick:D=>y(g)(c.row.idx)},{default:a(()=>[t(P,null,{default:a(()=>[m("\uD30C\uC77C\uB3D9\uAE30\uD654")]),_:1})]),_:2},1032,["onClick"]),t(O,{round:"",flat:"",icon:"delete",color:"red-10",size:"sm",onClick:D=>y(k)(c.row)},{default:a(()=>[t(P,null,{default:a(()=>[m("\uC0AD\uC81C")]),_:1})]),_:2},1032,["onClick"])])]),_:2},1032,["props"])]),_:2},1032,["props","class"])]),_:1},8,["columns","rows"]))}},Ml={"--calendar-active-date-background":"#fff","--calendar-border-current":"#3eaf7c 2px solid"},Ae=N([]),F=N({}),ie=N(Ge.formatDate(Date.now(),"YYYY-MM-DD"));new Date(ie.value).getMonth()+1;const Vl=(e,d)=>{const x="text-white rounded-border";if(e.active===!1)return"bg-grey-3";switch(e.repeat){case"once":return`bg-blue-5 ${x}`;case"everyDay":return`bg-green-5 ${x}`;case"everyWeek":return`bg-purple-5 ${x}`;case"workDays":return`bg-orange-5 ${x}`}},at=()=>{F.value={};for(let e of He.value)switch(e.repeat){case"once":Object.keys(F.value).includes(e.date)===!1&&(F.value[e.date]=[]),F.value[e.date].push(e);break;case"everyDay":for(let d of Ae.value)Object.keys(F.value).includes(d.date)===!1&&(F.value[d.date]=[]),F.value[d.date].push(e);break;case"everyWeek":case"workDays":for(let d of Ae.value)e.weekDays.includes(d.weekday)&&(Object.keys(F.value).includes(d.date)===!1&&(F.value[d.date]=[]),F.value[d.date].push(e));break}},$l=e=>{Ae.value=e.days,at()},zl=e=>{switch(e){case"once":return"\uBC18\uBCF5\uC5C6\uC74C";case"everyDay":return"\uB9E4\uC77C";case"everyWeek":return"\uB9E4\uC8FC";case"workDays":return"\uD3C9\uC77C";default:return"\uBC18\uBCF5\uC5C6\uC74C"}};const Ql={class:"q-gutter-x-xs"},Pl={__name:"PopupSchedule",props:["event"],setup(e){const{fnDeleteSchedule:d,fnSyncFileSchedule:x,fnActiveSchedule:k}=Ye();return(h,g)=>(v(),Q(Te,{style:{"border-radius":"10px"}},{default:a(()=>[t(Xe,{class:"popup"},{default:a(()=>[t(R,{class:"row no-wrap justify-between items-center q-pt-md q-pb-sm"},{default:a(()=>[r("div",Ql,[t(S,{name:"event",color:e.event.active?"primary":"grey-3",size:"sm"},null,8,["color"]),r("span",{class:ge(["font-main",e.event.active?"":"text-grey-3"])},w(e.event.name),3)]),r("div",null,[t(O,{flat:"",round:"",icon:e.event.active?"check_circle":"block",color:e.event.active?"positive":"negative",size:"sm",onClick:g[0]||(g[0]=p=>y(k)(e.event))},{default:a(()=>[t(P,null,{default:a(()=>[m(w(e.event.active?"\uD65C\uC131\uD654":"\uBE44\uD65C\uC131\uD654"),1)]),_:1})]),_:1},8,["icon","color"]),t(O,{round:"",flat:"",icon:"backup",size:"sm",color:"primary",onClick:g[1]||(g[1]=p=>y(x)(e.event.idx))},{default:a(()=>[t(P,null,{default:a(()=>[m("\uD30C\uC77C\uB3D9\uAE30\uD654")]),_:1})]),_:1}),t(O,{round:"",flat:"",icon:"delete",size:"sm",color:"red-10",onClick:g[2]||(g[2]=p=>y(d)(e.event))},{default:a(()=>[t(P,null,{default:a(()=>[m("\uC0AD\uC81C")]),_:1})]),_:1})])]),_:1}),t(X),t(R,{class:"q-py-none"},{default:a(()=>[t(Dt,{class:ge(e.event.active?"":"text-grey-5")},{default:a(()=>[t(E,null,{default:a(()=>[t(G,null,{default:a(()=>[t(A,null,{default:a(()=>[m("\uC0AC\uC6A9\uC790")]),_:1}),t(A,{caption:""},{default:a(()=>[m(w(e.event.user),1)]),_:1})]),_:1})]),_:1}),t(E,null,{default:a(()=>[t(G,null,{default:a(()=>[t(A,null,{default:a(()=>[m("\uBC18\uBCF5")]),_:1}),t(A,{caption:""},{default:a(()=>[m(w(y(zl)(e.event.repeat)),1)]),_:1})]),_:1})]),_:1}),e.event.repeat==="once"?(v(),Q(E,{key:0},{default:a(()=>[t(G,null,{default:a(()=>[t(A,null,{default:a(()=>[m("\uB0A0\uC9DC")]),_:1}),t(A,{caption:""},{default:a(()=>[m(w(e.event.date),1)]),_:1})]),_:1})]),_:1})):H("",!0),e.event.repeat==="everyWeek"?(v(),Q(E,{key:1},{default:a(()=>[t(G,null,{default:a(()=>[t(A,null,{default:a(()=>[m("\uC694\uC77C")]),_:1}),t(A,{caption:""},{default:a(()=>[m(w(y(Gt)(e.event.weekDays).join(",")),1)]),_:1})]),_:1})]),_:1})):H("",!0),t(E,null,{default:a(()=>[t(G,null,{default:a(()=>[t(A,null,{default:a(()=>[m("\uC2DC\uAC04")]),_:1}),t(A,{caption:""},{default:a(()=>[m(w(e.event.time),1)]),_:1})]),_:1})]),_:1}),t(E,null,{default:a(()=>[t(G,null,{default:a(()=>[t(A,null,{default:a(()=>[m("\uD30C\uC77C")]),_:1}),t(A,{caption:""},{default:a(()=>[m(w(e.event.file.base),1)]),_:1})]),_:1})]),_:1}),e.event.description?(v(),Q(E,{key:2},{default:a(()=>[t(G,null,{default:a(()=>[t(A,null,{default:a(()=>[m("\uC124\uBA85")]),_:1}),t(A,{caption:""},{default:a(()=>[m(w(e.event.description),1)]),_:1})]),_:1})]),_:1})):H("",!0)]),_:1},8,["class"])]),_:1}),t(Je,{align:"right",class:"q-pt-none"},{default:a(()=>[be(t(O,{flat:"",round:"",icon:"cancel",color:"red-10"},null,512),[[Ie]])]),_:1})]),_:1})]),_:1}))}};var Ol=Ue(Pl,[["__scopeId","data-v-d5fe2846"]]);const Tl={style:{position:"relative"}},Il={class:"month-view"},Al={class:"row no-wrap justify-center q-gutter-x-sm"},jl={style:{display:"flex"}},Yl={class:"title q-calendar__ellipsis"},Fl={__name:"monthView",setup(e){Ye();const d=N(null);return Oe(He,()=>{at()}),Ee(()=>{Fe(),console.log("schedules",F.value)}),(x,k)=>{const h=qt("q-calendar-month");return v(),z(re,null,[r("div",Tl,[r("div",Il,w(y(Ge).formatDate(y(ie),"YYYY\uB144 MM\uC6D4")),1),r("div",Al,[t(O,{color:"primary",icon:"keyboard_arrow_left",round:"",flat:"",onClick:k[0]||(k[0]=()=>d.value.prev())}),t(O,{color:"primary",icon:"home",round:"",flat:"",onClick:k[1]||(k[1]=g=>d.value.moveToToday())}),t(O,{color:"primary",icon:"keyboard_arrow_right",round:"",flat:"",onClick:k[2]||(k[2]=g=>d.value.next())})])]),r("div",jl,[t(h,{ref_key:"calendar",ref:d,style:Ct(y(Ml)),modelValue:y(ie),"onUpdate:modelValue":k[3]||(k[3]=g=>St(ie)?ie.value=g:null),locale:"ko-kr",weekdays:[0,1,2,3,4,5,6],"date-type":"rounded","day-min-height":"100","no-active-date":"",animated:"",bordered:"",onChange:y($l)},{day:a(({scope:{timestamp:g}})=>[(v(!0),z(re,null,De(y(F)[g.date],p=>(v(),z("div",{key:p.id,class:ge(["schedule",y(Vl)(p,"month")])},[r("div",Yl,w(p.time)+" : "+w(p.name),1),t(P,null,{default:a(()=>[m(w(p.time)+" : "+w(p.name),1)]),_:2},1024),t(Ol,{event:p},null,8,["event"])],2))),128))]),_:1},8,["style","modelValue","onChange"])])],64)}}};var Hl=Ue(Fl,[["__scopeId","data-v-26eff92d"]]);function Ul(e,d){if(e.hour!==null){if(e.minute===null)return"minute";if(d===!0&&e.second===null)return"second"}return"hour"}function Bl(){const e=new Date;return{hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds(),millisecond:e.getMilliseconds()}}var Kl=Mt({name:"QTime",props:{...Vt,...$t,...nl,mask:{default:null},format24h:{type:Boolean,default:null},defaultDate:{type:String,validator:e=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(e)},options:Function,hourOptions:Array,minuteOptions:Array,secondOptions:Array,withSeconds:Boolean,nowBtn:Boolean},emits:ol,setup(e,{slots:d,emit:x}){const k=At(),{$q:h}=k.proxy,g=zt(e,h),{tabindex:p,headerClass:j,getLocale:c,getCurrentDate:D}=sl(e,h),s=Qt(e),T=jt(s);let b,B;const ee=N(null),te=V(()=>rt()),le=V(()=>c()),ce=V(()=>ct()),$=ke(e.modelValue,te.value,le.value,e.calendar,ce.value),u=N(Ul($)),o=N($),M=N($.hour===null||$.hour<12),nt=V(()=>`q-time q-time--${e.landscape===!0?"landscape":"portrait"}`+(g.value===!0?" q-time--dark q-dark":"")+(e.disable===!0?" disabled":e.readonly===!0?" q-time--readonly":"")+(e.bordered===!0?" q-time--bordered":"")+(e.square===!0?" q-time--square no-border-radius":"")+(e.flat===!0?" q-time--flat no-shadow":"")),Ce=V(()=>{const l=o.value;return{hour:l.hour===null?"--":Y.value===!0?ae(l.hour):String(M.value===!0?l.hour===0?12:l.hour:l.hour>12?l.hour-12:l.hour),minute:l.minute===null?"--":ae(l.minute),second:l.second===null?"--":ae(l.second)}}),Y=V(()=>e.format24h!==null?e.format24h:h.lang.date.format24h),ot=V(()=>{const l=u.value==="hour",n=l===!0?12:60,i=o.value[u.value];let C=`rotate(${Math.round(i*(360/n))-180}deg) translateX(-50%)`;return l===!0&&Y.value===!0&&o.value.hour>=12&&(C+=" scale(.7)"),{transform:C}}),Be=V(()=>o.value.hour!==null),st=V(()=>Be.value===!0&&o.value.minute!==null),ne=V(()=>e.hourOptions!==void 0?l=>e.hourOptions.includes(l):e.options!==void 0?l=>e.options(l,null,null):null),de=V(()=>e.minuteOptions!==void 0?l=>e.minuteOptions.includes(l):e.options!==void 0?l=>e.options(o.value.hour,l,null):null),me=V(()=>e.secondOptions!==void 0?l=>e.secondOptions.includes(l):e.options!==void 0?l=>e.options(o.value.hour,o.value.minute,l):null),K=V(()=>{if(ne.value===null)return null;const l=ve(0,11,ne.value),n=ve(12,11,ne.value);return{am:l,pm:n,values:l.values.concat(n.values)}}),oe=V(()=>de.value!==null?ve(0,59,de.value):null),se=V(()=>me.value!==null?ve(0,59,me.value):null),fe=V(()=>{switch(u.value){case"hour":return K.value;case"minute":return oe.value;case"second":return se.value}}),ut=V(()=>{let l,n,i=0,_=1;const C=fe.value!==null?fe.value.values:void 0;u.value==="hour"?Y.value===!0?(l=0,n=23):(l=0,n=11,M.value===!1&&(i=12)):(l=0,n=55,_=5);const U=[];for(let f=l,I=l;f<=n;f+=_,I++){const Z=f+i,bt=C!==void 0&&C.includes(Z)===!1,xt=u.value==="hour"&&f===0?Y.value===!0?"00":"12":f;U.push({val:Z,index:I,disable:bt,label:xt})}return U}),it=V(()=>[[rl,dt,void 0,{stop:!0,prevent:!0,mouse:!0}]]);Oe(()=>e.modelValue,l=>{const n=ke(l,te.value,le.value,e.calendar,ce.value);(n.dateHash!==o.value.dateHash||n.timeHash!==o.value.timeHash)&&(o.value=n,n.hour===null?u.value="hour":M.value=n.hour<12)}),Oe([te,le],()=>{Pt(()=>{Qe()})});function Ke(){const l={...D(),...Bl()};Qe(l),Object.assign(o.value,l),u.value="hour"}function ve(l,n,i){const _=Array.apply(null,{length:n+1}).map((C,U)=>{const f=U+l;return{index:f,val:i(f)===!0}}).filter(C=>C.val===!0).map(C=>C.index);return{min:_[0],max:_[_.length-1],values:_,threshold:n+1}}function Ne(l,n,i){const _=Math.abs(l-n);return Math.min(_,i-_)}function Se(l,{min:n,max:i,values:_,threshold:C}){if(l===n)return n;if(l<n||l>i)return Ne(l,n,C)<=Ne(l,i,C)?n:i;const U=_.findIndex(Z=>l<=Z),f=_[U-1],I=_[U];return l-f<=I-l?f:I}function rt(){return e.calendar!=="persian"&&e.mask!==null?e.mask:`HH:mm${e.withSeconds===!0?":ss":""}`}function ct(){if(typeof e.defaultDate!="string"){const l=D(!0);return l.dateHash=ul(l),l}return ke(e.defaultDate,"YYYY/MM/DD",void 0,e.calendar)}function Me(){return Yt(k)===!0||fe.value!==null&&(fe.value.values.length===0||u.value==="hour"&&Y.value!==!0&&K.value[M.value===!0?"am":"pm"].values.length===0)}function Ve(){const l=ee.value,{top:n,left:i,width:_}=l.getBoundingClientRect(),C=_/2;return{top:n+C,left:i+C,dist:C*.7}}function dt(l){if(Me()!==!0){if(l.isFirst===!0){b=Ve(),B=_e(l.evt,b);return}B=_e(l.evt,b,B),l.isFinal===!0&&(b=!1,B=null,We())}}function We(){u.value==="hour"?u.value="minute":e.withSeconds&&u.value==="minute"&&(u.value="second")}function _e(l,n,i){const _=Ot(l),C=Math.abs(_.top-n.top),U=Math.sqrt(Math.pow(Math.abs(_.top-n.top),2)+Math.pow(Math.abs(_.left-n.left),2));let f,I=Math.asin(C/U)*(180/Math.PI);if(_.top<n.top?I=n.left<_.left?90-I:270+I:I=n.left<_.left?I+90:270-I,u.value==="hour"){if(f=I/30,K.value!==null){const Z=Y.value!==!0?M.value===!0:K.value.am.values.length!==0&&K.value.pm.values.length!==0?U>=n.dist:K.value.am.values.length!==0;f=Se(f+(Z===!0?0:12),K.value[Z===!0?"am":"pm"])}else f=Math.round(f),Y.value===!0?U<n.dist?f<12&&(f+=12):f===12&&(f=0):M.value===!0&&f===12?f=0:M.value===!1&&f!==12&&(f+=12);Y.value===!0&&(M.value=f<12)}else f=Math.round(I/6)%60,u.value==="minute"&&oe.value!==null?f=Se(f,oe.value):u.value==="second"&&se.value!==null&&(f=Se(f,se.value));return i!==f&&kt[u.value](f),f}const $e={hour(){u.value="hour"},minute(){u.value="minute"},second(){u.value="second"}};function mt(l){l.keyCode===13&&Le()}function ft(l){l.keyCode===13&&Re()}function vt(l){Me()!==!0&&(h.platform.is.desktop!==!0&&_e(l,Ve()),We())}function _t(l){Me()!==!0&&_e(l,Ve())}function yt(l){if(l.keyCode===13)u.value="hour";else if([37,39].includes(l.keyCode)){const n=l.keyCode===37?-1:1;if(K.value!==null){const i=Y.value===!0?K.value.values:K.value[M.value===!0?"am":"pm"].values;if(i.length===0)return;if(o.value.hour===null)ye(i[0]);else{const _=(i.length+i.indexOf(o.value.hour)+n)%i.length;ye(i[_])}}else{const i=Y.value===!0?24:12,_=Y.value!==!0&&M.value===!1?12:0,C=o.value.hour===null?-n:o.value.hour;ye(_+(24+C+n)%i)}}}function ht(l){if(l.keyCode===13)u.value="minute";else if([37,39].includes(l.keyCode)){const n=l.keyCode===37?-1:1;if(oe.value!==null){const i=oe.value.values;if(i.length===0)return;if(o.value.minute===null)he(i[0]);else{const _=(i.length+i.indexOf(o.value.minute)+n)%i.length;he(i[_])}}else{const i=o.value.minute===null?-n:o.value.minute;he((60+i+n)%60)}}}function pt(l){if(l.keyCode===13)u.value="second";else if([37,39].includes(l.keyCode)){const n=l.keyCode===37?-1:1;if(se.value!==null){const i=se.value.values;if(i.length===0)return;if(o.value.seconds===null)pe(i[0]);else{const _=(i.length+i.indexOf(o.value.second)+n)%i.length;pe(i[_])}}else{const i=o.value.second===null?-n:o.value.second;pe((60+i+n)%60)}}}function ye(l){o.value.hour!==l&&(o.value.hour=l,ue())}function he(l){o.value.minute!==l&&(o.value.minute=l,ue())}function pe(l){o.value.second!==l&&(o.value.second=l,ue())}const kt={hour:ye,minute:he,second:pe};function Le(){M.value===!1&&(M.value=!0,o.value.hour!==null&&(o.value.hour-=12,ue()))}function Re(){M.value===!0&&(M.value=!1,o.value.hour!==null&&(o.value.hour+=12,ue()))}function ze(l){const n=e.modelValue;u.value!==l&&n!==void 0&&n!==null&&n!==""&&typeof n!="string"&&(u.value=l)}function ue(){if(ne.value!==null&&ne.value(o.value.hour)!==!0){o.value=ke(),ze("hour");return}if(de.value!==null&&de.value(o.value.minute)!==!0){o.value.minute=null,o.value.second=null,ze("minute");return}if(e.withSeconds===!0&&me.value!==null&&me.value(o.value.second)!==!0){o.value.second=null,ze("second");return}o.value.hour===null||o.value.minute===null||e.withSeconds===!0&&o.value.second===null||Qe()}function Qe(l){const n=Object.assign({...o.value},l),i=e.calendar==="persian"?ae(n.hour)+":"+ae(n.minute)+(e.withSeconds===!0?":"+ae(n.second):""):Tt(new Date(n.year,n.month===null?null:n.month-1,n.day,n.hour,n.minute,n.second,n.millisecond),te.value,le.value,n.year,n.timezoneOffset);n.changed=i!==e.modelValue,x("update:modelValue",i,n)}function wt(){const l=[q("div",{class:"q-time__link "+(u.value==="hour"?"q-time__link--active":"cursor-pointer"),tabindex:p.value,onClick:$e.hour,onKeyup:yt},Ce.value.hour),q("div",":"),q("div",Be.value===!0?{class:"q-time__link "+(u.value==="minute"?"q-time__link--active":"cursor-pointer"),tabindex:p.value,onKeyup:ht,onClick:$e.minute}:{class:"q-time__link"},Ce.value.minute)];e.withSeconds===!0&&l.push(q("div",":"),q("div",st.value===!0?{class:"q-time__link "+(u.value==="second"?"q-time__link--active":"cursor-pointer"),tabindex:p.value,onKeyup:pt,onClick:$e.second}:{class:"q-time__link"},Ce.value.second));const n=[q("div",{class:"q-time__header-label row items-center no-wrap",dir:"ltr"},l)];return Y.value===!1&&n.push(q("div",{class:"q-time__header-ampm column items-between no-wrap"},[q("div",{class:"q-time__link "+(M.value===!0?"q-time__link--active":"cursor-pointer"),tabindex:p.value,onClick:Le,onKeyup:mt},"AM"),q("div",{class:"q-time__link "+(M.value!==!0?"q-time__link--active":"cursor-pointer"),tabindex:p.value,onClick:Re,onKeyup:ft},"PM")])),q("div",{class:"q-time__header flex flex-center no-wrap "+j.value},n)}function gt(){const l=o.value[u.value];return q("div",{class:"q-time__content col relative-position"},[q(Ft,{name:"q-transition--scale"},()=>q("div",{key:"clock"+u.value,class:"q-time__container-parent absolute-full"},[q("div",{ref:ee,class:"q-time__container-child fit overflow-hidden"},[be(q("div",{class:"q-time__clock cursor-pointer non-selectable",onClick:vt,onMousedown:_t},[q("div",{class:"q-time__clock-circle fit"},[q("div",{class:"q-time__clock-pointer"+(o.value[u.value]===null?" hidden":e.color!==void 0?` text-${e.color}`:""),style:ot.value}),ut.value.map(n=>q("div",{class:`q-time__clock-position row flex-center q-time__clock-pos-${n.index}`+(n.val===l?" q-time__clock-position--active "+j.value:n.disable===!0?" q-time__clock-position--disable":"")},[q("span",n.label)]))])]),it.value)])])),e.nowBtn===!0?q(O,{class:"q-time__now-button absolute",icon:h.iconSet.datetime.now,unelevated:!0,size:"sm",round:!0,color:e.color,textColor:e.textColor,tabindex:p.value,onClick:Ke}):null])}return k.proxy.setNow=Ke,()=>{const l=[gt()],n=It(d.default);return n!==void 0&&l.push(q("div",{class:"q-time__actions"},n)),e.name!==void 0&&e.disable!==!0&&T(l,"push"),q("div",{class:nt.value,tabindex:-1},[wt(),q("div",{class:"q-time__main col overflow-auto"},l)])}}});J.locale("ko");const Nl=()=>{const{fnNotiError:e}=et(),d=async h=>new Promise(async(g,p)=>{if(h.file||p(e("\uD30C\uC77C\uC744 \uC120\uD0DD\uD574\uC8FC\uC138\uC694","\uC0C8\uB85C\uC6B4 \uC608\uC57D\uC5D0 \uD30C\uC77C\uC744 \uC120\uD0DD\uD574\uC8FC\uC138\uC694")),h.devices.length||p(e("\uBC29\uC1A1\uAD6C\uAC04\uC744 \uC120\uD0DD\uD574\uC8FC\uC138\uC694","\uC0C8\uB85C\uC6B4 \uC608\uC57D\uC5D0 \uBC29\uC1A1\uAD6C\uAC04\uC744 \uC120\uD0DD\uD574\uC8FC\uC138\uC694")),console.log(await x(h)),await x(h)&&p(e("\uC608\uC57D\uBC29\uC1A1\uC774 \uC774\uBBF8 \uC874\uC7AC \uD569\uB2C8\uB2E4","\uD574\uB2F9 \uC2DC\uAC04\uACFC \uC9C0\uC5ED\uC758 \uC608\uC57D \uBC29\uC1A1\uC774 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4.")),h.repeat==="once"){const j=J(`${h.date} ${h.time}`);J().isAfter(j)&&p(e("\uC608\uC57D \uC2DC\uAC04\uC774 \uC774\uBBF8 \uC9C0\uB098\uAC14\uC2B5\uB2C8\uB2E4","\uC608\uC57D \uC2DC\uAC04\uC744 \uB2E4\uC2DC \uD655\uC778\uD574\uC8FC\uC138\uC694."))}h.repeat==="everyWeek"&&h.weekDays.sort((j,c)=>j-c),g()}),x=async h=>{try{const{_id:g,time:p,repeat:j,date:c,weekDays:D,devices:s}=h,{data:T}=await Ht.get("/broadcast/schedule/exists",{params:{time:p,devices:s.map(b=>b.deviceId)}});if(T.schedules&&T.schedules.length){for(let b of T.schedules)if(b._id!==g)switch(j){case"everyDay":if(k(s,b.devices))return!0;break;case"once":switch(b.repeat){case"everyDay":if(k(s,b.devices))return!0;break;case"once":if(b.date===c&&k(s,b.devices))return!0;break;case"everyWeek":const B=new Date(c).getDay();if(b.weekDays.includes(B))return!0;break}break;case"week":switch(b.repeat){case"everyDay":case"once":let B=new Date(b.date).getDay();if(D.includes(B))return!0;break;case"everyWeek":for(let ee of D)if(b.weekDays.includes(ee))return!0;break}break}}return!1}catch(g){throw g}},k=(h,g)=>{const p=h.map(D=>D.deviceId),j=g.map(D=>D.deviceId),c=p.filter(D=>j.includes(D));for(let D of c){const s=h.find(b=>b.deviceId===D).value.map(b=>b.Zone),T=g.find(b=>b.deviceId===D).Zones;for(let b of s)if(T.includes(b))return!0}return!1};return{fnCheckSchedule:d,fnExistsSchedule:x,fnCheckZones:k}};const W=e=>(Lt("data-v-203e0b7c"),e=e(),Rt(),e),Wl={class:"row no-wrap justify-between items-center"},Ll={class:"dialog-name row no-wrap items-center q-gutter-x-sm"},Rl=W(()=>r("div",{class:"font-main"},"\uC608\uC57D\uBC29\uC1A1 \uCD94\uAC00",-1)),Zl={class:"row no-wrap items-center q-gutter-x-xs"},El=W(()=>r("span",null,"\uC774\uB984",-1)),Gl={class:"row no-wrap items-center q-gutter-x-xs"},Xl=W(()=>r("span",null,"\uBC18\uBCF5 \uC124\uC815",-1)),Jl={class:"q-pa-xs"},ea={class:"row items-center justify-end"},ta={class:"row items-center justify-end"},la={class:"row no-wrap justify-between items-center"},aa={class:"row no-wrap items-center q-gutter-x-xs"},na=W(()=>r("span",null,"\uBC29\uC1A1 \uAD6C\uAC04",-1)),oa={key:0,class:"panel q-py-sm q-px-sm q-mt-sm q-gutter-x-sm row justify-start items-center",style:{"border-radius":"2px","min-height":"40px"}},sa={key:1,class:"panel q-pa-sm q-mt-sm row justify-start items-center",style:{"border-radius":"2px",height:"40px"}},ua=W(()=>r("span",null," \uC120\uD0DD\uB41C \uBC29\uC1A1\uAD6C\uAC04\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. ",-1)),ia=[ua],ra={class:"row no-wrap justify-between items-center q-mb-md"},ca={class:"row no-wrap items-center q-gutter-x-xs"},da=W(()=>r("span",null,"\uCC60\uC784",-1)),ma={class:"row no-wrap justify-between items-center"},fa={class:"row no-wrap items-center q-gutter-x-xs"},va=W(()=>r("span",null,"\uD30C\uC77C",-1)),_a={class:"q-gutter-x-sm"},ya={key:0,class:"panel q-py-sm q-px-sm q-mt-sm q-gutter-x-sm row justify-start items-center",style:{"border-radius":"2px","min-height":"40px"}},ha={key:1,class:"panel q-pa-sm q-mt-sm row justify-start items-center",style:{"border-radius":"2px",height:"40px"}},pa=W(()=>r("span",null," \uC120\uD0DD\uB41C \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. ",-1)),ka=[pa],wa={class:"row no-wrap justify-between items-center"},ga={class:"row no-wrap items-center q-gutter-x-xs"},ba=W(()=>r("span",null,"\uC0C1\uC138\uC124\uBA85",-1)),xa={__name:"DialogAddSchedule",setup(e){J.locale("ko");const d=qe(),{dialogRef:x,onDialogOK:k,onDialogCancel:h}=Ut(),{fnCheckSchedule:g}=Nl(),{fnPlayStart:p,modal:j}=lt(),{fnDeleteFile:c}=pl(),D=V({get(){return s.Preamble==="Chime ascending triple.wav"},set(){return s.Preamble?s.Preamble="":s.Preamble="Chime ascending triple.wav"}}),s=Bt({name:"",repeat:"once",pageMode:"file",weekDays:[],date:J().format("YYYY-MM-DD"),time:J().format("HH:mm"),Preamble:"",devices:[],zones:[],file:null,MessageDelete:!1,description:""}),T=N(!1),b=()=>{d.dialog({component:ml,componentProps:{selected:s.devices}}).onOk($=>{s.devices=$,s.zones=fl($)})},B=()=>{d.dialog({component:vl,componentProps:{file:s.file}}).onOk($=>{s.file=$[0],s.pageMode="file"})},ee=()=>{Wt.value.ttsMode==="sapi"?d.dialog({component:_l,componentProps:{file:s.file}}).onOk($=>{s.file=$,s.pageMode="TTS"}):d.dialog({component:yl,componentProps:{file:s.file}}).onOk($=>{s.file=$,s.pageMode="TTS"})},te=async()=>{s.pageMode==="TTS"&&(j.value=!1,await c()),s.file=null},le=async()=>{d.loading.show({message:"\uC608\uC57D\uBC29\uC1A1 \uB0B4\uC6A9\uC744 \uD655\uC778 \uC911\uC785\uB2C8\uB2E4."});try{s.repeat!=="once"&&(s.data=""),await g(s),k(s)}catch($){console.error($)}finally{d.loading.hide()}},ce=$=>{$==="workDays"&&(s.weekDays=[1,2,3,4,5])};return($,u)=>(v(),Q(Nt,{ref_key:"dialogRef",ref:x,persistent:""},{default:a(()=>[t(Xe,{class:"q-dialog-plugin bg-trans schedule_dialog",style:{"border-radius":"8px"}},{default:a(()=>[t(R,{class:"q-py-md"},{default:a(()=>[r("div",Wl,[r("div",Ll,[t(S,{name:"add_circle",color:"primary",size:"sm"}),Rl])])]),_:1}),t(X),t(dl,{onSubmit:le},{default:a(()=>[t(R,{class:"q-pb-none"},{default:a(()=>[r("div",Zl,[t(S,{name:"label",color:"primary",size:"sm"}),El]),t(we,{modelValue:s.name,"onUpdate:modelValue":u[0]||(u[0]=o=>s.name=o),dense:"",filled:"",label:"\uC774\uB984",rules:[y(Pe)],"lazy-rules":""},null,8,["modelValue","rules"])]),_:1}),t(X),t(R,{class:"q-pb-none"},{default:a(()=>[r("div",Gl,[t(S,{name:"schedule",color:"primary",size:"sm"}),Xl]),t(Ze,{modelValue:s.repeat,"onUpdate:modelValue":[u[1]||(u[1]=o=>s.repeat=o),ce],options:y(ll),dense:"",filled:"","emit-value":"","map-options":"",label:"\uBC18\uBCF5 \uBAA8\uB4DC",rules:[y(Pe)],"lazy-rules":""},null,8,["modelValue","options","rules"]),s.repeat==="everyWeek"||s.repeat==="workDays"?(v(),Q(Ze,{key:0,modelValue:s.weekDays,"onUpdate:modelValue":u[2]||(u[2]=o=>s.weekDays=o),options:y(al),dense:"",filled:"","stack-label":"","use-chips":"",multiple:"","emit-value":"","map-options":"",label:"\uC694\uC77C \uC120\uD0DD",rules:[o=>o.length||"\uD544\uC218 \uC785\uB825 \uD56D\uBAA9\uC785\uB2C8\uB2E4"],"lazy-rules":""},{"selected-item":a(o=>[r("div",Jl,[t(je,{dense:"",removable:"",onRemove:M=>o.removeAtIndex(o.index),tabindex:o.tabindex,color:"white","text-color":"primary",class:"q-ma-none"},{default:a(()=>[m(w(o.opt.label),1)]),_:2},1032,["onRemove","tabindex"])])]),_:1},8,["modelValue","options","rules"])):H("",!0),s.repeat==="once"?(v(),Q(we,{key:1,dense:"",filled:"",modelValue:s.date,"onUpdate:modelValue":u[4]||(u[4]=o=>s.date=o),label:"\uB0A0\uC9DC",rules:[y(hl)],"lazy-rules":""},{append:a(()=>[t(S,{name:"event",class:"cursor-pointer"},{default:a(()=>[t(Te,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[t(il,{modelValue:s.date,"onUpdate:modelValue":u[3]||(u[3]=o=>s.date=o),mask:"YYYY-MM-DD",rules:["date"],"today-btn":"",locale:y(tt)},{default:a(()=>[r("div",ea,[be(t(O,{label:"Close",color:"primary",flat:""},null,512),[[Ie]])])]),_:1},8,["modelValue","locale"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])):H("",!0),t(we,{dense:"",filled:"",modelValue:s.time,"onUpdate:modelValue":u[6]||(u[6]=o=>s.time=o),label:"\uC2DC\uAC04",mask:"time",rules:[y(Pe),"time"],"lazy-rules":""},{append:a(()=>[t(S,{name:"access_time",class:"cursor-pointer"},{default:a(()=>[t(Te,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[t(Kl,{modelValue:s.time,"onUpdate:modelValue":u[5]||(u[5]=o=>s.time=o),format24h:""},{default:a(()=>[r("div",ta,[be(t(O,{label:"Close",color:"primary",flat:""},null,512),[[Ie]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])]),_:1}),t(X),t(R,null,{default:a(()=>[r("div",la,[r("div",aa,[t(S,{name:"location_on",color:"primary",size:"sm"}),na]),t(S,{class:"cursor-pointer",name:"add_circle",color:"primary",size:"sm",onClick:b},{default:a(()=>[t(P,null,{default:a(()=>[m("\uBC29\uC1A1\uAD6C\uAC04\uC120\uD0DD")]),_:1})]),_:1})]),s.zones&&s.zones.length?(v(),z("div",oa,[(v(!0),z(re,null,De(s.zones,(o,M)=>(v(),Q(cl,{key:M},{default:a(()=>[m(w(o),1)]),_:2},1024))),128))])):(v(),z("div",sa,ia))]),_:1}),t(X,{class:"q-my-sm"}),t(R,null,{default:a(()=>[r("div",ra,[r("div",ca,[t(S,{name:"notifications",color:"primary",size:"sm"}),da]),t(Kt,{modelValue:D.value,"onUpdate:modelValue":u[7]||(u[7]=o=>D.value=o)},null,8,["modelValue"])]),r("div",ma,[r("div",fa,[t(S,{name:"save",color:"primary",size:"sm"}),va]),r("div",_a,[t(S,{class:"cursor-pointer",name:"add_circle",color:"primary",size:"sm",onClick:B},{default:a(()=>[t(P,null,{default:a(()=>[m("\uD30C\uC77C\uC120\uD0DD")]),_:1})]),_:1}),t(S,{class:"cursor-pointer",name:"volume_up",color:"blue-10",size:"sm",onClick:ee},{default:a(()=>[t(P,null,{default:a(()=>[m("\uC74C\uC131\uD569\uC131")]),_:1})]),_:1})])]),s.file?(v(),z("div",ya,[r("div",null,[t(S,{class:"cursor-pointer",name:"play_arrow",color:"primary",size:"xs",onClick:u[8]||(u[8]=o=>y(p)(s.file))}),m(" "+w(s.file.base),1)]),t(S,{class:"cursor-pointer q-mr-sm",name:"cancel",color:"red-10",size:"sm",onClick:te})])):(v(),z("div",ha,ka))]),_:1}),t(X),t(R,null,{default:a(()=>[r("div",wa,[r("div",ga,[t(S,{name:"list_alt",color:"grey",size:"sm"}),ba]),T.value?(v(),Q(S,{key:0,class:"cursor-pointer",name:"keyboard_arrow_down",color:"purple-10",size:"sm",onClick:u[9]||(u[9]=o=>T.value=!T.value)},{default:a(()=>[t(P,null,{default:a(()=>[m("\uB2EB\uAE30")]),_:1})]),_:1})):(v(),Q(S,{key:1,class:"cursor-pointer",name:"keyboard_arrow_up",color:"purple-10",size:"sm",onClick:u[10]||(u[10]=o=>T.value=!T.value)},{default:a(()=>[t(P,null,{default:a(()=>[m("\uB354\uBCF4\uAE30")]),_:1})]),_:1}))]),T.value?(v(),Q(we,{key:0,class:"q-mt-md",modelValue:s.description,"onUpdate:modelValue":u[11]||(u[11]=o=>s.description=o),label:"\uC124\uBA85",filled:"",type:"textarea"},null,8,["modelValue"])):H("",!0)]),_:1}),t(Je,{align:"right"},{default:a(()=>[t(O,{round:"",flat:"",color:"red-10",icon:"cancel",onClick:y(h)},null,8,["onClick"]),t(O,{round:"",flat:"","no-caps":"",color:"primary",icon:"check_circle",type:"submit"})]),_:1})]),_:1})]),_:1})]),_:1},512))}};var Da=Ue(xa,[["__scopeId","data-v-203e0b7c"]]);J.locale("ko");const qa=()=>{const e=qe(),{fnNotiError:d}=et();return{fnAddSchedule:async()=>{e.dialog({component:Da}).onOk(async k=>{try{e.loading.show({message:"\uBC29\uC1A1 \uC608\uC57D\uC744 \uB4F1\uB85D \uC911\uC785\uB2C8\uB2E4."});const{data:h}=await Xt(k);e.loading.hide(),e.loading.show({message:"\uD30C\uC77C\uC744 \uC5C5\uBB34\uBC29\uC1A1 \uC8FC\uC7A5\uCE58\uB85C \uC804\uC1A1\uC911 \uC785\uB2C8\uB2E4"}),await Jt(h.idx),await Fe(),e.loading.hide()}catch(h){console.error(h),d("\uBC29\uC1A1 \uC608\uC57D \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4","\uC7A0\uC2DC\uD6C4\uC5D0 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.")}finally{e.loading.hide()}})}}},Ca={class:"borderd"},Sa={class:"q-px-lg q-py-sm row no-wrap justify-between items-center bg-grey-2"},Ma={class:"row no-wrap items-center q-gutter-x-sm q-py-xs"},Va=r("div",{class:"font-main"},"\uC2A4\uCF00\uC904 \uBC29\uC1A1",-1),tn={__name:"SchedulePage",setup(e){const{fnAddSchedule:d}=qa();return qe(),(x,k)=>(v(),Q(Zt,{class:"page"},{default:a(()=>[r("div",Ca,[r("div",Sa,[r("div",Ma,[t(S,{name:"today",color:"primary",size:"md"}),Va,t(S,{class:"cursor-pointer",name:"add_circle",size:"sm",color:"primary",onClick:y(d)},{default:a(()=>[t(P,null,{default:a(()=>[m("\uC608\uC57D\uCD94\uAC00")]),_:1})]),_:1},8,["onClick"])]),t(wl)]),r("div",null,[y(xe)==="list"?(v(),Q(Sl,{key:0})):H("",!0),y(xe)==="month"?(v(),Q(Hl,{key:1})):H("",!0)])])]),_:1}))}};export{tn as default};
