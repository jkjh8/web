import{a as R,Q as se}from"./QTable.9b92951a.js";import{Q as N,a as F,l as H}from"./useLocale.850aed12.js";import{Q as re}from"./QTr.a7260de6.js";import{ax as J,r as _,o as X,x as h,y as ee,z as r,k as n,L as ue,M as W,A as g,N as C,aT as T,J as u,q as Y,H as E,aP as te,az as ie,O as ce,aA as de,u as ve,i as fe,K as B,v as pe,c as A,bl as L,f as me,aY as Z,B as V,D as Q,E as S,F as le,a$ as oe,j as ge,a1 as be,bh as _e,n as we,bm as ye,h as O,Q as xe,g as he,bn as Ve,G as P,bo as Se}from"./index.93de1c34.js";import{Q as Ce}from"./QPagination.91e9b1ef.js";import{C as j}from"./ClosePopup.7960069f.js";import{Q as ke}from"./QTooltip.58f974ba.js";var Ee=[{name:"createdAt",label:"Time",align:"center",field:"createdAt",sortable:!0},{name:"level",label:"Level",align:"center",field:"level",sortable:!0},{name:"source",label:"Source",align:"center",field:"source",sortable:!0},{name:"zones",label:"Zones",align:"center",field:"zones",sortable:!0},{name:"message",label:"Message",align:"left",field:"message",sortable:!0}];const Le={class:"row no-wrap items-center q-gutter-x-md"},Me=g("div",null,[g("div",{class:"font-main"},"\uAC80\uC0C9\uC635\uC158"),g("div",{class:"caption"},"\uB0A0\uC9DC \uBC0F \uAE30\uAC04 \uD544\uD130 \uC801\uC6A9")],-1),Re={class:"q-px-md"},Oe={class:"row items-center justify-end"},Qe={class:"row items-center justify-end"},qe={__name:"logOptions",props:["start","end","mode","logLevel"],emits:[...J.emits],setup(t,{emit:v}){const{dialogRef:s,onDialogOK:a,onDialogCancel:o}=J(),c=t,l=_(""),e=_(""),i=_([]);return X(()=>{l.value=c.start,e.value=c.end,i.value=c.logLevel}),(b,p)=>(h(),ee(ce,{ref_key:"dialogRef",ref:s,persistent:""},{default:r(()=>[n(ue,{class:"q-dialog-plugin bg-trans",style:{"border-radius":"8px"}},{default:r(()=>[n(W,null,{default:r(()=>[g("div",Le,[n(C,{name:"search",color:"primary",size:"sm"}),Me])]),_:1}),n(W,null,{default:r(()=>[g("div",Re,[n(T,{dense:"",filled:"",modelValue:l.value,"onUpdate:modelValue":p[1]||(p[1]=m=>l.value=m),mask:"date",rules:["date"],label:"\uAC80\uC0C9 \uC2DC\uC791"},{append:r(()=>[n(C,{name:"event",class:"cursor-pointer"},{default:r(()=>[n(N,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[n(F,{modelValue:l.value,"onUpdate:modelValue":p[0]||(p[0]=m=>l.value=m),locale:u(H)},{default:r(()=>[g("div",Oe,[Y(n(E,{label:"Close",color:"primary",flat:""},null,512),[[j]])])]),_:1},8,["modelValue","locale"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(T,{dense:"",filled:"",modelValue:e.value,"onUpdate:modelValue":p[3]||(p[3]=m=>e.value=m),mask:"date",rules:["date"],label:"\uAC80\uC0C9 \uC885\uB8CC"},{append:r(()=>[n(C,{name:"event",class:"cursor-pointer"},{default:r(()=>[n(N,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[n(F,{modelValue:e.value,"onUpdate:modelValue":p[2]||(p[2]=m=>e.value=m),locale:u(H)},{default:r(()=>[g("div",Qe,[Y(n(E,{label:"Close",color:"primary",flat:""},null,512),[[j]])])]),_:1},8,["modelValue","locale"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(te,{modelValue:i.value,"onUpdate:modelValue":p[4]||(p[4]=m=>i.value=m),options:t.mode==="event"?[{label:"EVENT",value:4},{label:"EVENT ERROR",value:5}]:[{label:"ERROR",value:0},{label:"WARN",value:1},{label:"INFO",value:2},{label:"DEBUG",value:3},{label:"EVENT",value:4},{label:"EVENT ERROR",value:5}],multiple:"",filled:"",dense:i.value.length===0,label:"LOG \uB4F1\uAE09",clearable:"","use-chips":""},null,8,["modelValue","options","dense"])])]),_:1}),n(ie,{align:"right"},{default:r(()=>[n(E,{round:"",flat:"",color:"red-10",icon:"cancel",onClick:u(o)},null,8,["onClick"]),n(E,{round:"",flat:"","no-caps":"",color:"primary",icon:"check_circle",onClick:p[5]||(p[5]=m=>u(a)({start:l.value,end:e.value,logLevel:i.value}))})]),_:1})]),_:1})]),_:1},512))}},y=de("logs",()=>{const t=ve(),v=fe("api"),{user:s}=B(pe()),a=_(""),o=_(""),c=_(""),l=_([]),e=_([]),i=_("event"),b=_({sortBy:"createdAt",descending:!0,page:1,rowsPerPage:10,rowsNumber:0}),p=A(()=>o.value||c.value||l.value.length),m=d=>{i.value=d==="system"?d:"event",e.value=[]},$=async d=>{l.value=l.value.filter(f=>f!==d),await k()},M=()=>l.value.length?l.value.map(d=>d.value):i.value==="event"?[4,5]:null,k=async(d={pagination:b.value,filter:a.value})=>{try{t.loading.show();const f={...d,level:M(),start:o.value,end:c.value,devices:z()},{data:w}=await v.get(`/logs?options=${JSON.stringify(f)}`);e.value=w.current,b.value=w.pagination}catch(f){console.error(f)}finally{t.loading.hide()}},z=()=>s.value.isAdmin?null:s.value.zones&&s.value.zones.length?s.value.zones:[];return{filter:a,start:o,end:c,logLevel:l,logs:e,mode:i,pagination:b,fnShowFilter:p,fnSetMode:m,fnRemoveLogLevel:$,fnGetLogs:k,fnGetZones:z,fnResetOptions:async()=>{o.value="",c.value="",l.value=[],b.value.page=1,await k({pagination:b.value,filter:a.value})},fnLogOptions:()=>{t.dialog({component:qe,componentProps:{start:o.value,end:c.value,logLevel:l.value,mode:i.value}}).onOk(async d=>{const{start:f,end:w,logLevel:D}=d;if(L(f,"YYYY/MM/DD").isAfter(L()))return fnNotiError("\uC2DC\uC791 \uC2DC\uAC04\uC774 \uC624\uB298\uBCF4\uB2E4 \uB2A6\uC2B5\uB2C8\uB2E4.");if(L(f,"YYYY/MM/DD").isAfter(L(w,"YYYY/MM/DD")))return fnNotiError("\uC2DC\uC791 \uC2DC\uAC04\uC774 \uC885\uB8CC \uC2DC\uAC04\uBCF4\uB2E4 \uB2A6\uC2B5\uB2C8\uB2E4.");o.value=f,c.value=w,l.value=D,b.value.page=1,await k({pagination:b.value,filter:a.value})})},fnSetColorLog:d=>({error:"bg-red-10 text-white",warn:"bg-yellow-3",debug:"bg-indigo-1",event:"bg-teal-2","event error":"bg-red-2"})[d]||"",fnSetEventColor:d=>({"event error":"bg-negative text-white"})[d]||"",fnSplitMessage:d=>{let f="";f=d.length>100?d.substring(0,100)+"...":d;const w=f.indexOf(":");return w!==-1&&w<20?[f.substring(0,w+1),f.substring(w+1)]:f.split(" ")},fnCheckText:(d,f)=>{const w={\uBC29\uC1A1:"text-blue","Q-SYS":"text-orange-10",BARIX:"text-green-10",SERVER:"text-grey","SOCKET.IO":"text-grey"};let D=f===0?["text-bold"]:[];for(const[ne,ae]of Object.entries(w))d.includes(ne)&&D.push(ae);return D.join(" ")}}}),$e={style:{"font-size":"0.8rem"}},ze={class:"q-pa-md"},tt={__name:"LogTable",props:["mode"],setup(t){L.locale("ko");const v=t,{logs:s,filter:a,pagination:o}=B(y());return me(()=>{y().fnSetMode(v.mode)}),X(()=>{y().fnGetLogs()}),(c,l)=>(h(),ee(se,{flat:"",columns:u(Ee),rows:u(s),filter:u(a),"row-key":"_id","wrap-cells":"","hide-pagination":"",pagination:u(o),"onUpdate:pagination":l[0]||(l[0]=e=>ge(o)?o.value=e:null),onRequest:u(y)().fnGetLogs},{body:r(e=>[n(re,{props:e,class:Z(t.mode!=="event"?u(y)().fnSetColorLog(e.row.level):u(y)().fnSetEventColor(e.row.level))},{default:r(()=>[n(R,{key:"createdAt",props:e},{default:r(()=>[g("div",$e,V(u(L)(e.row.createdAt).format("YYYY-MM-DD hh:mm:ss A")),1)]),_:2},1032,["props"]),n(R,{key:"level",props:e},{default:r(()=>[Q(V(e.row.level.toUpperCase()),1)]),_:2},1032,["props"]),n(R,{key:"source",props:e},{default:r(()=>[Q(V(e.row.source),1)]),_:2},1032,["props"]),n(R,{key:"zones",props:e},{default:r(()=>[Q(V(e.row.zones&&e.row.zones.length?e.row.zones.join(","):""),1)]),_:2},1032,["props"]),n(R,{class:"message",key:"message",props:e},{default:r(()=>[(h(!0),S(le,null,oe(u(y)().fnSplitMessage(e.row.message),(i,b)=>(h(),S("span",{key:b,class:Z(["q-ml-xs",u(y)().fnCheckText(i,b)])},V(i),3))),128)),n(N,null,{default:r(()=>[g("div",ze,V(e.row.message),1)]),_:2},1024)]),_:2},1032,["props"])]),_:2},1032,["props","class"])]),_:1},8,["columns","rows","filter","pagination","onRequest"]))}};function q(t,v=new WeakMap){if(Object(t)!==t)return t;if(v.has(t))return v.get(t);const s=t instanceof Date?new Date(t):t instanceof RegExp?new RegExp(t.source,t.flags):t instanceof Set?new Set:t instanceof Map?new Map:typeof t.constructor!="function"?Object.create(null):t.prototype!==void 0&&typeof t.prototype.constructor=="function"?t:new t.constructor;if(typeof t.constructor=="function"&&typeof t.valueOf=="function"){const a=t.valueOf();if(Object(a)!==a){const o=new t.constructor(a);return v.set(t,o),o}}return v.set(t,s),t instanceof Set?t.forEach(a=>{s.add(q(a,v))}):t instanceof Map&&t.forEach((a,o)=>{s.set(o,q(a,v))}),Object.assign(s,...Object.keys(t).map(a=>({[a]:q(t[a],v)})))}var De=be({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(t,{slots:v,emit:s}){const{proxy:a}=he(),{$q:o}=a,c=_(null),l=_(""),e=_("");let i=!1;const b=A(()=>_e({initialValue:l.value,validate:t.validate,set:p,cancel:m,updatePosition:$},"value",()=>e.value,x=>{e.value=x}));function p(){t.validate(e.value)!==!1&&(M()===!0&&(s("save",e.value,l.value),s("update:modelValue",e.value)),k())}function m(){M()===!0&&s("cancel",e.value,l.value),k()}function $(){we(()=>{c.value.updatePosition()})}function M(){return ye(e.value,l.value)===!1}function k(){i=!0,c.value.hide()}function z(){i=!1,l.value=q(t.modelValue),e.value=q(t.modelValue),s("beforeShow")}function U(){s("show")}function G(){i===!1&&M()===!0&&(t.autoSave===!0&&t.validate(e.value)===!0?(s("save",e.value,l.value),s("update:modelValue",e.value)):s("cancel",e.value,l.value)),s("beforeHide")}function K(){s("hide")}function I(){const x=v.default!==void 0?[].concat(v.default(b.value)):[];return t.title&&x.unshift(O("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},t.title)),t.buttons===!0&&x.push(O("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[O(E,{flat:!0,color:t.color,label:t.labelCancel||o.lang.label.cancel,onClick:m}),O(E,{flat:!0,color:t.color,label:t.labelSet||o.lang.label.set,onClick:p})])),x}return Object.assign(a,{set:p,cancel:m,show(x){c.value!==null&&c.value.show(x)},hide(x){c.value!==null&&c.value.hide(x)},updatePosition:$}),()=>{if(t.disable!==!0)return O(xe,{ref:c,class:"q-popup-edit",cover:t.cover,onBeforeShow:z,onShow:U,onBeforeHide:G,onHide:K,onEscapeKey:m},I)}}});const Pe={class:"row justify-center q-py-md",style:{position:"relative"}},Ne={class:"row items-center q-px-md",style:{position:"absolute",right:"0",top:"1px","font-size":"0.8rem"}},Te=g("span",null,"\uD398\uC774\uC9C0\uB2F9 \uD45C\uC2DC",-1),lt={__name:"Pagination",props:["pagination"],emits:["update:pagination","update:page"],setup(t,{emit:v}){const s=t,a=v,o=A(()=>s.pagination);return(c,l)=>(h(),S("div",Pe,[n(Ce,{modelValue:o.value.page,"onUpdate:modelValue":[l[0]||(l[0]=e=>o.value.page=e),l[1]||(l[1]=e=>a("update:pagination",o.value))],max:o.value.rowsNumber/o.value.rowsPerPage,"max-pages":8,size:"12px",flat:"","active-design":"outline","direction-links":"","boundary-links":""},null,8,["modelValue","max"]),g("div",Ne,[Te,n(te,{style:{"font-size":"0.8rem"},borderless:"","item-aligned":"",dense:"","hide-bottom-space":"","map-options":"",modelValue:o.value.rowsPerPage,"onUpdate:modelValue":[l[2]||(l[2]=e=>o.value.rowsPerPage=e),l[3]||(l[3]=e=>a("update:pagination",o.value))],options:[5,10,15,20,25,30,40,50]},null,8,["modelValue"]),n(C,{name:"settings",size:"xs",color:"primary"},{default:r(()=>[n(De,{modelValue:o.value.page,"onUpdate:modelValue":l[4]||(l[4]=e=>o.value.page=e),"max-width":"160px"},{default:r(e=>[n(T,{modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,dense:"",autofocus:"","auto-save":"",type:"number",label:"\uD398\uC774\uC9C0 \uBC14\uB85C\uAC00\uAE30",onKeyup:Ve(i=>{o.value.page=Number(e.value),a("update:pagination",o.value)},["enter"])},{append:r(()=>[Y(n(C,{class:"cursor-pointer",name:"send",color:"primary",size:"xs",onClick:i=>{o.value.page=Number(e.value),a("update:pagination",o.value)}},null,8,["onClick"]),[[j]])]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"])]),_:1},8,["modelValue"])]),_:1})])]))}},Ye={key:0,class:"q-pa-sm bg-blue-grey-1 row justify-center items-center"},je={class:"q-gutter-x-sm row no-wrap items-center"},Be={key:0,class:"q-gutter-x-xs row items-center"},Ae=g("span",{class:"text-bold"},"\uB0A0\uC9DC",-1),Ue=g("span",null,"~",-1),Ge={key:1,class:"q-gutter-x-xs row items-center"},Ke=g("span",{class:"text-bold"},"\uB85C\uADF8 \uB808\uBCA8",-1),ot={__name:"Options",setup(t){const{fnShowFilter:v,start:s,end:a,logLevel:o}=B(y());return(c,l)=>u(v)?(h(),S("div",Ye,[g("div",je,[u(s)||u(a)?(h(),S("div",Be,[n(C,{name:"calendar_month",color:"primary",size:"sm"}),Ae,g("span",null,V(u(s)),1),Ue,g("span",null,V(u(a)),1)])):P("",!0),u(o).length?(h(),S("div",Ge,[n(C,{name:"label",color:"primary",size:"sm"}),Ke,(h(!0),S(le,null,oe(u(o),e=>(h(),S("span",{key:e},[n(Se,{dense:"",color:"primary","text-color":"white",removable:"",onRemove:i=>u(y)().fnRemoveLogLevel(e)},{default:r(()=>[Q(V(e.label),1)]),_:2},1032,["onRemove"])]))),128))])):P("",!0),n(C,{class:"cursor-pointer q-ml-md",name:"cancel",color:"red-10",size:"xs",onClick:u(y)().fnResetOptions},{default:r(()=>[n(ke,null,{default:r(()=>[Q("\uD574\uC81C")]),_:1})]),_:1},8,["onClick"])])])):P("",!0)}};export{ot as _,tt as a,lt as b,y as u};
