import{aK as T,v as V,r as d,c as M,o as P,y as g,z as O,A as s,B as t,j as a,S as _,L as q,H as c,aR as Y,J as y,C as n,K as $,b0 as D,D as b,bB as F,F as R,a$ as U,O as E}from"./index.866f479f.js";import{Q as h}from"./QTooltip.c447365b.js";import{Q as G,a as m}from"./QTable.5b602739.js";import{Q as I}from"./QTr.666adf8d.js";import{Q as J}from"./QPage.ae304a4d.js";import{h as v}from"./locale.d09498a2.js";import{f as K,a as H,_ as Z}from"./useLogs.d62d92d8.js";import"./ClosePopup.e4ce3c17.js";const j={class:"borderd"},W={class:"q-px-lg q-py-sm row no-wrap justify-between items-center bg-grey-3"},X={class:"row no-wrap items-center q-gutter-x-sm q-py-xs"},ee=t("div",{class:"font-main"},"\uC2DC\uC2A4\uD15C \uB85C\uADF8",-1),ae={class:"row no-wrap items-center q-gutter-x-sm"},se={key:0,class:"q-pa-sm bg-blue-grey-1 row justify-center items-center"},te={class:"q-gutter-x-sm row no-wrap items-center"},oe=t("span",{class:"text-bold"},"\uB0A0\uC9DC",-1),re=t("span",null,"~",-1),ne={style:{"font-size":"0.8rem"}},_e={__name:"SystemLogPage",setup(le){const{fnNotiError:k}=T(),A=[{name:"createdAt",label:"Time",align:"center",field:"createdAt",sortable:!0},{name:"level",label:"Level",align:"center",field:"level",sortable:!0},{name:"source",label:"Source",align:"center",field:"source",sortable:!0},{name:"zones",label:"Zones",align:"center",field:"zones",sortable:!0},{name:"message",label:"Message",align:"left",field:"message",sortable:!0}],w=V(),f=d(""),l=d(""),i=d(""),x=d([]),u=d({sortBy:"createdAt",descending:!0,page:1,rowsPerPage:10,rowsNumber:0}),B=M(()=>l.value||i.value),N=o=>{switch(o){case"error":return"bg-red text-white";case"warn":return"bg-yellow-1";case"debug":return"bg-blue-1";case"event":return"bg-green-1";case"info":return""}},z=async o=>{try{w.loading.show();const r={...o,level:0,start:l.value,end:i.value},{data:e}=await E.get(`/logs?options=${JSON.stringify(r)}`);x.value=e.current,u.value=e.pagination}catch(r){console.error(r)}finally{w.loading.hide()}},p=async()=>{await z({pagination:u.value,filter:f.value})},S=async()=>{l.value="",i.value="",await p()},L=()=>{w.dialog({component:Z,componentProps:{start:l.value,end:i.value}}).onOk(async o=>{if(v(new Date(o.start)).isAfter(v())){k("\uC2DC\uC791 \uC2DC\uAC04\uC774 \uC624\uB298\uBCF4\uB2E4 \uB2A6\uC2B5\uB2C8\uB2E4.");return}if(v(new Date(o.start)).isAfter(v(new Date(o.end)))){k("\uC2DC\uC791 \uC2DC\uAC04\uC774 \uC885\uB8CC \uC2DC\uAC04\uBCF4\uB2E4 \uB2A6\uC2B5\uB2C8\uB2E4.");return}l.value=o.start,i.value=o.end,u.value.page=1,await p()})};return P(async()=>{await p()}),(o,r)=>(g(),O(J,{class:"page"},{default:s(()=>[t("div",j,[t("div",W,[t("div",X,[a(_,{name:"list_alt",color:"primary",size:"md"}),ee,a(q,{flat:"",dense:"",round:"",icon:"refresh",color:"primary",onClick:p},{default:s(()=>[a(h,null,{default:s(()=>[c("\uC0C8\uB85C\uACE0\uCE68")]),_:1})]),_:1})]),t("div",ae,[a(Y,{modelValue:f.value,"onUpdate:modelValue":r[0]||(r[0]=e=>f.value=e),borderless:"",dense:"",debounce:"300",placeholder:"Search",clearable:""},{append:s(()=>[a(_,{class:"cursor-pointer",name:"search"})]),_:1},8,["modelValue"]),a(q,{flat:"",round:"",icon:"settings",size:"sm",color:"primary",onClick:L},{default:s(()=>[a(h,null,{default:s(()=>[c("\uAC80\uC0C9\uC635\uC158")]),_:1})]),_:1})])]),B.value?(g(),y("div",se,[t("div",te,[a(_,{name:"calendar_month",color:"primary",size:"sm"}),oe,t("span",null,n(l.value),1),re,t("span",null,n(i.value),1),a(_,{class:"cursor-pointer",name:"cancel",color:"red-10",size:"xs",onClick:S},{default:s(()=>[a(h,null,{default:s(()=>[c("\uD574\uC81C")]),_:1})]),_:1})])])):$("",!0),a(G,{flat:"",columns:A,rows:x.value,filter:f.value,"row-key":"_id","wrap-cells":"",pagination:u.value,"onUpdate:pagination":r[1]||(r[1]=e=>u.value=e),onRequest:z},{body:s(e=>[a(I,{props:e,class:D(N(e.row.level))},{default:s(()=>[a(m,{key:"createdAt",props:e},{default:s(()=>[t("div",ne,n(b(F).formatDate(e.row.createdAt,"YYYY-MM-DD hh:mm:ss a")),1)]),_:2},1032,["props"]),a(m,{key:"level",props:e},{default:s(()=>[c(n(e.row.level.toUpperCase()),1)]),_:2},1032,["props"]),a(m,{key:"source",props:e},{default:s(()=>[c(n(e.row.source),1)]),_:2},1032,["props"]),a(m,{key:"zones",props:e},{default:s(()=>[c(n(e.row.zones&&e.row.zones.length?e.row.zones.join(","):""),1)]),_:2},1032,["props"]),a(m,{class:"message",key:"message",props:e},{default:s(()=>[(g(!0),y(R,null,U(b(K)(e.row.message),(Q,C)=>(g(),y("span",{key:C,class:D(["q-ml-xs",b(H)(Q,C)])},n(Q),3))),128))]),_:2},1032,["props"])]),_:2},1032,["props","class"])]),_:1},8,["rows","filter","pagination"])])]),_:1}))}};export{_e as default};
